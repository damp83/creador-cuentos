<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Taller de Cuentos Interactivo con IA</title>
    <link rel="icon" href="data:,">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;700;900&family=Merriweather:wght@400;700&family=Fredoka+One&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <link rel="stylesheet" href="style.css">
    <!-- Quill editor styles -->
    <link href="https://cdn.jsdelivr.net/npm/quill@1.3.7/dist/quill.snow.css" rel="stylesheet">
</head>
<body>

    <div class="storybook-container">
        <aside class="sidebar">
            <div class="sidebar-header"><i data-lucide="book-heart"></i><span>Taller de Cuentos</span></div>
            <nav class="sidebar-nav">
                <ul id="main-nav">
                    <li><a href="#" class="nav-link" data-view="creator"><i data-lucide="pencil"></i> Taller</a></li>
                    <li><a href="#" class="nav-link" data-view="library"><i data-lucide="library"></i> Mi Biblioteca</a></li>
                </ul>
                <hr>
                <ul id="creator-nav" style="display: none;">
                    <li><a href="#" class="nav-link" data-step="1"><i data-lucide="sparkles"></i> Idea</a></li>
                    <li><a href="#" class="nav-link" data-step="2"><i data-lucide="user-round"></i> Personajes</a></li>
                    <li><a href="#" class="nav-link" data-step="3"><i data-lucide="mountain-snow"></i> Portada</a></li>
                    <li><a href="#" class="nav-link" data-step="4"><i data-lucide="align-left"></i> Introducción</a></li>
                    <li><a href="#" class="nav-link" data-step="5"><i data-lucide="align-center"></i> Desarrollo</a></li>
                    <li><a href="#" class="nav-link" data-step="6"><i data-lucide="align-right"></i> Desenlace</a></li>
                    <li><a href="#" class="nav-link" data-step="7"><i data-lucide="award"></i> Final</a></li>
                    <li><a href="#" class="nav-link" data-step="8"><i data-lucide="book-open-check"></i> Resultado</a></li>
                </ul>
            </nav>
        </aside>

        <div id="creator-view" class="main-content-wrapper">
            <div class="steps-container">
                <section id="step1" class="main-content">
                    <div class="step-header"><h2>¡Empecemos la Aventura!</h2><p>Toda gran historia necesita una chispa de inspiración.</p></div>
                    <div class="step-content">
                        <button id="idea-generator-btn" class="nav-btn"><i data-lucide="shuffle"></i>Generar una idea loca</button>
                        <div class="idea-card-container">
                            <div class="idea-card"><h4>PERSONAJE</h4><p id="idea-char"></p></div>
                            <div class="idea-card"><h4>LUGAR</h4><p id="idea-place"></p></div>
                            <div class="idea-card"><h4>MISIÓN</h4><p id="idea-mission"></p></div>
                        </div>
                    </div>
                </section>
                <section id="step2" class="main-content">
                    <div class="step-header"><h2>Crea tus Personajes</h2><p>Diseña a los protagonistas de tu increíble historia.</p></div>
                    <div class="step-content">
                        <div class="character-tabs" id="character-tabs"></div>
                        <div class="character-builder">
                            <div class="avatar-preview-wrapper">
                                <div class="avatar-preview" id="avatar-preview"></div>
                                <div class="form-group" style="width:100%; margin-top: 15px;">
                                    <label for="char-name">Nombre del Personaje</label>
                                    <input type="text" id="char-name" placeholder="Escribe un nombre">
                                </div>
                                <div class="form-group" style="width:100%; margin-top: 10px;">
                                    <label for="char-role">Rol en la historia</label>
                                    <select id="char-role">
                                        <option value="protagonist">Protagonista</option>
                                        <option value="friend">Amigo/a</option>
                                        <option value="villain">Antagonista</option>
                                    </select>
                                </div>
                            </div>
                            <div class="avatar-options">
                                <div id="ai-builder">
                                    <p>Describe tu personaje y la IA lo creará automáticamente.</p>
                                    <button id="open-ai-assistant-btn" class="nav-btn" style="background-color: var(--ai-color);">Abrir Asistente de Creación IA</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
                <section id="step3" class="main-content">
                    <div class="step-header"><h2>Portada</h2><p>Crea una portada llamativa para tu cuento.</p></div>
                    <div class="step-content">
                        <div class="form-group">
                            <label for="cover-prompt">Describe tu portada</label>
                            <textarea id="cover-prompt" rows="3" placeholder="Ej: Un título grande con letras de caramelo, un fondo de cielo estrellado y los personajes sonrientes"></textarea>
                        </div>
                        <div style="display:flex; gap:12px; align-items:center; margin: 8px 0 16px 0;">
                            <button id="generate-cover-btn" class="nav-btn" style="background-color: var(--ai-color);">
                                <i data-lucide="image"></i> Generar Portada con IA
                            </button>
                            <small style="color:#718096">La portada se guardará automáticamente</small>
                        </div>
                        <div style="display:flex; align-items:center; gap:10px; margin-bottom:6px;">
                            <button id="check-api-btn" class="nav-btn" style="background:#edf2f7; color:#2d3748; padding:6px 10px; font-size:12px;">Comprobar API</button>
                            <small id="api-health" style="color:#718096"></small>
                        </div>
                        <div class="illustration-preview" id="cover-preview"></div>
                    </div>
                </section>
                <section id="step4" class="main-content">
                    <div class="step-header"><h2>Introducción</h2><p>Añade tantas páginas como necesites.</p></div>
                    <div class="step-content">
                        <div class="writing-layout">
                            <div class="pages-sidebar">
                                <button id="add-intro-page-btn" class="nav-btn"><i data-lucide="plus"></i> Añadir Página</button>
                                <div class="page-thumbs" id="intro-thumbs"></div>
                            </div>
                            <div class="page-editor" id="intro-editor"></div>
                        </div>
                    </div>
                </section>
                <section id="step5" class="main-content">
                    <div class="step-header"><h2>Desarrollo</h2><p>¡Aquí ocurre la gran aventura!</p></div>
                    <div class="step-content">
                        <div class="writing-layout">
                            <div class="pages-sidebar">
                                <button id="add-dev-page-btn" class="nav-btn"><i data-lucide="plus"></i> Añadir Página</button>
                                <div class="page-thumbs" id="dev-thumbs"></div>
                            </div>
                            <div class="page-editor" id="dev-editor"></div>
                        </div>
                    </div>
                </section>
                <section id="step6" class="main-content">
                    <div class="step-header"><h2>Desenlace</h2><p>¿Cómo termina la historia?</p></div>
                    <div class="step-content">
                        <div class="writing-layout">
                            <div class="pages-sidebar">
                                <button id="add-end-page-btn" class="nav-btn"><i data-lucide="plus"></i> Añadir Página</button>
                                <div class="page-thumbs" id="end-thumbs"></div>
                            </div>
                            <div class="page-editor" id="end-editor"></div>
                        </div>
                    </div>
                </section>
                <section id="step7" class="main-content">
                    <div class="step-header"><h2>Los Toques Finales</h2><p>¡Revisa tu portada y tus páginas antes de terminar!</p></div>
                    <div class="step-content">
                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="show-page-numbers">
                                Mostrar numeración de páginas en el resultado
                            </label>
                        </div>
                    </div>
                </section>
                <section id="step8" class="main-content">
                    <div class="step-header"><h2>¡Tu Cuento Mágico!</h2><p>¡Felicidades, has creado una historia increíble!</p></div>
                    <div class="step-content">
                        <article class="story-preview-container"><h3 id="preview-title"></h3><p class="author-line"><em>por <span id="preview-author"></span></em></p><div id="preview-content"></div></article>
                        <div class="final-buttons"><button id="save-to-library-btn" class="nav-btn"><i data-lucide="save"></i> Guardar en mi Biblioteca</button><button id="restart-btn" class="nav-btn"><i data-lucide="rotate-cw"></i> Crear otro</button></div>
                    </div>
                </section>
            </div>
            <div class="navigation">
                <button id="prev-btn" class="nav-btn" disabled><i data-lucide="arrow-left"></i> Atrás</button>
                <div id="nav-page-controls" class="nav-page-controls"></div>
                <button id="next-btn" class="nav-btn">Siguiente <i data-lucide="arrow-right"></i></button>
            </div>
        </div>

        <div id="library-view" class="main-content-wrapper">
             <div class="step-header" style="padding: 40px 40px 0 40px;"><h2>Mi Biblioteca de Cuentos</h2><p>Aquí están todas las aventuras que has creado.</p></div>
            <div id="bookshelf"></div>
            <button id="new-story-from-library-btn" class="nav-btn"><i data-lucide="plus-circle"></i> Crear un Cuento Nuevo</button>
        </div>
    </div>
    
    <div class="modal-overlay" id="rhyme-modal">
        <div class="modal-content">
            <h3>Diccionario de Rimas</h3>
            <p>Escribe una palabra para encontrar otras que rimen.</p>
            <input type="text" id="rhyme-input" placeholder="Ej: canción">
            <div id="rhyme-results"></div>
            <button id="close-rhyme-modal" class="nav-btn" style="margin-top: 20px;">Cerrar</button>
        </div>
    </div>

    <div class="modal-overlay" id="ai-character-modal">
        <div class="modal-content">
            <h3>Asistente de Creación IA</h3>
            <p>¡Describe el personaje de tus sueños y la IA lo dibujará para ti!</p>
            <div class="modal-grid">
                <div class="form-group">
                    <label for="ai-char-type">Especie / Tipo</label>
                    <input type="text" id="ai-char-type" placeholder="Ej: zorro, robot, mago..." />
                </div>
                <div class="form-group">
                    <label for="ai-char-age">Edad visual</label>
                    <input type="text" id="ai-char-age" placeholder="Ej: niño, adolescente, adulto, anciano" />
                </div>
                <div class="form-group">
                    <label for="ai-char-hair">Pelo</label>
                    <input type="text" id="ai-char-hair" placeholder="Ej: corto y azul / sin pelo" />
                </div>
                <div class="form-group">
                    <label for="ai-char-eyes">Ojos</label>
                    <input type="text" id="ai-char-eyes" placeholder="Ej: grandes y verdes" />
                </div>
                <div class="form-group">
                    <label for="ai-char-skin">Piel / Pelaje</label>
                    <input type="text" id="ai-char-skin" placeholder="Ej: piel morena / pelaje naranja" />
                </div>
                <div class="form-group">
                    <label for="ai-char-clothing">Ropa</label>
                    <input type="text" id="ai-char-clothing" placeholder="Ej: camiseta roja y vaqueros" />
                </div>
                <div class="form-group">
                    <label for="ai-char-accessories">Accesorios</label>
                    <input type="text" id="ai-char-accessories" placeholder="Ej: gafas redondas, mochila" />
                </div>
                <div class="form-group modal-full-width">
                    <label for="ai-char-feature">Rasgo especial</label>
                    <input type="text" id="ai-char-feature" placeholder="Ej: pequeñas alas de hada" />
                </div>
                <div class="form-group modal-full-width">
                    <label for="ai-char-visual-style">Estilo visual</label>
                    <input type="text" id="ai-char-visual-style" placeholder="Ej: acuarela, crayón, estilo Pixar" />
                </div>
            </div>
            <div style="display: flex; justify-content: space-between; margin-top: 20px;">
                <button id="close-ai-modal" class="nav-btn" style="background-color: #a0aec0;">Cerrar</button>
                <button id="generate-ai-avatar-btn" class="nav-btn" style="background-color: var(--ai-color);">Crear Personaje</button>
            </div>
        </div>
    </div>
    
    <div class="modal-overlay" id="ai-scene-modal">
        <div class="modal-content">
            <h3>Asistente de Ilustración de Escenas</h3>
            <p>Describe el mundo de tu historia y la IA lo dibujará.</p>
            <div class="form-group">
                <label for="ai-scene-prompt">¿Qué está pasando en esta parte de la historia?</label>
                <textarea id="ai-scene-prompt" rows="4" placeholder="Ej: El zorro pirata navega en su barco por un mar de chocolate bajo una luna de queso."></textarea>
            </div>
            <div class="form-group">
                <label>Selecciona los personajes que aparecen en esta escena</label>
                <div id="scene-characters-list" class="scene-characters-list"></div>
            </div>
            <div style="display: flex; justify-content: space-between; margin-top: 20px;">
                <button id="close-ai-scene-modal" class="nav-btn" style="background-color: #a0aec0;">Cerrar</button>
                <button id="generate-ai-scene-btn" class="nav-btn" style="background-color: var(--ai-color);">Ilustrar Escena</button>
            </div>
        </div>
    </div>

    <!-- Quill editor -->
    <script src="https://cdn.jsdelivr.net/npm/quill@1.3.7/dist/quill.min.js"></script>
    <!-- Config opcional: si alojas la UI en otro dominio distinto a las APIs, define aquí tu URL real de Vercel -->
    <script>
        window.ENV_API_BASE = 'https://creador-cuentos-c24w.vercel.app';
    </script>
    <script src="main.js"></script>
</body>
</html>
